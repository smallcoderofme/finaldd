<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0"/>
    <title>index</title>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body class="Site">
    <div class="row Site-content">
        <div class="col-md-3">
        </div>
    </div>
    <script>
        var data;
        $(function () {
            $.ajax({url: '/list',
                type: 'GET',
                success: function(res) {
                    data = res.data;
                    render();
                }
            });
        });

        function toggle(index) {
            console.log(index);
            let id = '#sub_menu' + index;
            let icon = '#icon' + index;
            let parent = document.querySelector(id);
            if (parent.innerHTML.length) {
                parent.innerHTML='';
                document.querySelector(icon).innerHTML = '+';
                return;
            }
            let currData = data[index].sub;
            let leng = currData.length;
            let subELe = '';
            for (let i =0;i < leng; i++) {
                subELe += `<div class="mb-2 mt-2 ml-5 h5 text-primary point" onclick="select_page(`
                    + '\''+ currData[i]['uuid'] + '\''+
                    `);">`+ currData[i].name +`</div>`;
            }
            document.querySelector(icon).innerHTML = '-';
            parent.innerHTML = subELe;

        }

        function select_page(pid) {
            console.log('page id: ', pid);
        }

        function render() {
            let containter = document.querySelector("div.col-md-3");
            let elements = '';
            let leng = data.length;
            for (let i =0;i < leng; i++) {
                elements += `<div id="menu`+ i +`" class="mb-4 unselect text-primary h3 font-weight-bold point">
                                <span class="ml-2 mr-2" onclick="toggle(`+ i +`);"><span id="icon`+i +`">+</span>`+ data[i].name +
                    `</span><div id="sub_menu`+ i +`"></div></div>`;
            }
            containter.innerHTML = elements;
            // document.querySelectorAll("script").forEach(function(e){ e.parentNode.removeChild(e); });
        }
    </script>
</body>
</html>